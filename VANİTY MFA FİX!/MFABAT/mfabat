const { Client, GatewayIntentBits, Partials, EmbedBuilder } = require('discord.js');

const token = "YOUR_USER_TOKEN"; // âš ï¸ Self token, dikkatli ol kanka

const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent,
  ],
  partials: [Partials.Channel, Partials.Message]
});

const snipeMap = new Map(); // kanal ID â†’ son silinen mesaj

client.on('ready', () => {
  console.log(`âœ… GiriÅŸ yapÄ±ldÄ±: ${client.user.tag}`);
  console.log('ğŸ’¬ Snipe sistemi aktif.');
});

// ğŸ”¥ MESAJ SÄ°LÄ°NÄ°NCE
client.on('messageDelete', async (msg) => {
  if (!msg.guild || !msg.content || msg.author.bot) return;

  snipeMap.set(msg.channel.id, {
    content: msg.content,
    author: msg.author.tag,
    id: msg.author.id,
    time: new Date().toLocaleString()
  });

  console.log(`ğŸ—‘ï¸ Mesaj silindi: ${msg.author.tag}: "${msg.content}" (${msg.channel.name})`);
});

// ğŸ› ï¸ MESAJ DÃœZENLENÄ°NCE
client.on('messageUpdate', async (oldMsg, newMsg) => {
  if (!oldMsg.content || !newMsg.content || oldMsg.author?.bot) return;

  console.log(`âœï¸ DÃ¼zenlendi [${oldMsg.author.tag}]`);
  console.log(`  Eski: ${oldMsg.content}`);
  console.log(`  Yeni: ${newMsg.content}`);
});

// â— KOMUT: !snipe
client.on('messageCreate', async (message) => {
  if (message.author.id !== client.user.id) return;

  if (message.content.toLowerCase() === '!snipe') {
    const sniped = snipeMap.get(message.channel.id);
    if (!sniped) {
      return message.reply("âŒ Ananin Ami GÃ¶tÃ¼");
    }

    const embed = new EmbedBuilder()
      .setTitle("ğŸ•µï¸â€â™‚ï¸ Son Silinen Mesaj")
      .addFields(
        { name: 'Yazan', value: `${sniped.author} (<@${sniped.id}>)` },
        { name: 'Ä°Ã§erik', value: sniped.content },
        { name: 'Zaman', value: sniped.time }
      )
      .setColor("Red");

    message.reply({ embeds: [embed] });
  }
});

client.login(token);
